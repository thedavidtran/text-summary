"use strict";var format=require("./format"),i18n=require("./i18n");module.exports=function(e){function a(e,a){var r=0;return Math.abs(.5-e.percentage)>Math.abs(.5-a.percentage)&&(r=-1),Math.abs(.5-e.percentage)<Math.abs(.5-a.percentage)&&(r=1),r}function r(e,a){var r=0;return Math.abs(e.percentage)>Math.abs(a.percentage)&&(r=-1),Math.abs(e.percentage)<Math.abs(a.percentage)&&(r=1),r}function t(e,a){var r,t={male:{"You are %s":"He is %s","You are %s and %s":"He is %s and %s","You are %s, %s and %s":"He is %s, %s and %s","And you are %s":"And he is %s","You are relatively unconcerned with both %s and %s":"He is relatively unconcerned with both %s and %s","You don't find %s to be particularly motivating for you":"He doesn't find %s to be particularly motivating for him","You value %s a bit more":"He values %s a bit more","You consider %s to guide a large part of what you do":"He considers %s to guide a large part of what he does","Experiences that make you feel high %s are generally unappealing to you":"Experiences that make him feel high %s are generally unappealing to him","Experiences that give a sense of %s hold some appeal to you":"Experiences that give a sense of %s hold some appeal to him","You are motivated to seek out experiences that provide a strong feeling of %s":"He is motivated to seek out experiences that provide a strong feeling of %s","Your choices are driven by a desire for %s":"His choices are driven by a desire for %s"},female:{"You are %s":"She is %s","You are %s and %s":"She is %s and %s","You are %s, %s and %s":"She is %s, %s and %s","And you are %s":"And she is %s","You are relatively unconcerned with both %s and %s":"She is relatively unconcerned with both %s and %s","You don't find %s to be particularly motivating for you":"She doesn't find %s to be particularly motivating for her","You value %s a bit more":"She values %s a bit more","You consider %s to guide a large part of what you do":"She considers %s to guide a large part of what she does","Experiences that make you feel high %s are generally unappealing to you":"Experiences that make her feel high %s are generally unappealing to her","Experiences that give a sense of %s hold some appeal to you":"Experiences that give a sense of %s hold some appeal to her","You are motivated to seek out experiences that provide a strong feeling of %s":"She is motivated to seek out experiences that provide a strong feeling of %s","Your choices are driven by a desire for %s":"Her choices are driven by a desire for %s"},"default":{"You are %s":"You are %s","You are %s and %s":"You are %s and %s","You are %s, %s and %s":"You are %s, %s and %s","And you are %s":"And you are %s","You are relatively unconcerned with both %s and %s":"You are relatively unconcerned with both %s and %s","You don't find %s to be particularly motivating for you":"You don't find %s to be particularly motivating for you","You value %s a bit more":"You value %s a bit more","You consider %s to guide a large part of what you do":"You consider %s to guide a large part of what you do","Experiences that make you feel high %s are generally unappealing to you":"Experiences that make you feel high %s are generally unappealing to you","Experiences that give a sense of %s hold some appeal to you":"Experiences that give a sense of %s hold some appeal to you","You are motivated to seek out experiences that provide a strong feeling of %s":"You are motivated to seek out experiences that provide a strong feeling of %s","Your choices are driven by a desire for %s":"Your choices are driven by a desire for %s"},they:{"You are %s":"They are %s","You are %s and %s":"They are %s and %s","You are %s, %s and %s":"They are %s, %s and %s","And you are %s":"And they are %s","You are relatively unconcerned with both %s and %s":"They are relatively unconcerned with both %s and %s","You don't find %s to be particularly motivating for you":"They don't find %s to be particularly motivating for them","You value %s a bit more":"They value %s a bit more","You consider %s to guide a large part of what you do":"They consider %s to guide a large part of what they do","Experiences that make you feel high %s are generally unappealing to you":"Experiences that make them feel high %s are generally unappealing to them","Experiences that give a sense of %s hold some appeal to you":"Experiences that give a sense of %s hold some appeal to them","You are motivated to seek out experiences that provide a strong feeling of %s":"They are motivated to seek out experiences that provide a strong feeling of %s","Your choices are driven by a desire for %s":"Their choices are driven by a desire for %s"}};return r=a&&t[a]||t["default"],r[e]||e}function o(e,a,r){var t=[e,a].sort(function(e,a){var r="EANOC".indexOf(e.id.charAt(0)),t="EANOC".indexOf(a.id.charAt(0));return t>r?-1:1}),o=t[0].id.concat(t[0].percentage>.5?"_plus_":"_minus_").concat(t[1].id).concat(t[1].percentage>.5?"_plus":"_minus"),s=g.circumplexData[o][0],n="%s";if(s.perceived_negatively)switch(r){case 0:n=y("a bit %s");break;case 1:n=y("somewhat %s");break;case 2:n=y("can be perceived as %s")}return format(n,s.word)}function s(e){var a,r,t=g.facetsData[e.id.replace("_","-").replace(" ","-")];return e.percentage>.5?(a=t.HighTerm.toLowerCase(),r=t.HighDescription.toLowerCase()):(a=t.LowTerm.toLowerCase(),r=t.LowDescription.toLowerCase()),{name:e.id,term:a,description:r}}function n(e){return Math.min(Math.floor(4*e),3)}function i(e){var a=g.valuesData[e.id.replace(/[_ ]/g,"-")][0],r=e.percentage>.5?a.HighDescription:a.LowDescription;return{name:e.id,term:a.Term.toLowerCase(),description:r}}function u(e){var a=g.needsData[e.id];return a}function c(e,r){var s,n,i,u,c,d=[],h=[];switch(e.children[0].children.forEach(function(e){h.push({id:e.id,percentage:e.percentage})}),h.sort(a),s=h.filter(function(e){return Math.abs(.5-e.percentage)>.18}),s.length<2&&(s=[h[0],h[1]]),s.length){case 2:n=o(s[0],s[1],0),d.push(format(y(t("You are %s",r)),n)+".");break;case 3:i=o(s[0],s[1],0),u=o(s[1],s[2],1),d.push(format(y(t("You are %s and %s",r)),i,u)+".");break;case 4:case 5:i=o(s[0],s[1],0),u=o(s[1],s[2],1),c=o(s[2],s[3],2),d.push(format(y(t("You are %s, %s and %s",r)),i,u,c)+".")}return d}function d(e,r){var o,n,i=[],u=[];if(e.children[0].children.forEach(function(e){e.children.forEach(function(a){u.push({id:a.id,percentage:a.percentage,parent:e})})}),u.sort(a),o=s(u[0]),i.push(format(y(t("You are %s",r)),o.term)+": "+o.description+"."),o=s(u[1]),i.push(format(y(t("You are %s",r)),o.term)+": "+o.description+"."),n=2,u[0].parent===u[1].parent)for(;u[0].parent===u[n].parent;)n+=1;return o=s(u[n]),i.push(format(y(t("And you are %s",r)),o.term)+": "+o.description+"."),i}function h(e,r){var o,s,u,c,d,h,l,p,f=[],g=[];if(e.children[0].children.forEach(function(e){g.push({id:e.id,percentage:e.percentage})}),g.sort(a),o=n(g[0].percentage)===n(g[1].percentage),s=i(g[0]),u=i(g[1]),o){switch(l=s.term,p=u.term,n(g[0].percentage)){case 0:c=format(y(t("You are relatively unconcerned with both %s and %s",r)),l,p)+".";break;case 1:c=format(y(t("You don't find either %s or %s to be particularly motivating for you",r)),l,p)+".";break;case 2:c=format(y(t("You value both %s and %s a bit",r)),l,p)+".";break;case 3:c=format(y(t("You consider both %s and %s to guide a large part of what you do",r)),l,p)+"."}f.push(c),f.push(s.description+"."),f.push(format(y("And %s"),u.description.toLowerCase())+".")}else for(d=[s,u],h=0;h<d.length;h+=1){switch(n(g[h].percentage)){case 0:c=format(y(t("You are relatively unconcerned with %s",r)),d[h].term);break;case 1:c=format(y(t("You don't find %s to be particularly motivating for you",r)),d[h].term);break;case 2:c=format(y(t("You value %s a bit more",r)),d[h].term);break;case 3:c=format(y(t("You consider %s to guide a large part of what you do",r)),d[h].term)}c=c.concat(": ").concat(d[h].description.toLowerCase()).concat("."),f.push(c)}return f}function l(e,a){var o,s,i=[],c=[];switch(e.children[0].children.forEach(function(e){c.push({id:e.id,percentage:e.percentage})}),c.sort(r),o=u(c[0])[0],n(c[0].percentage)){case 0:s=y(t("Experiences that make you feel high %s are generally unappealing to you",a));break;case 1:s=y(t("Experiences that give a sense of %s hold some appeal to you",a));break;case 2:s=y(t("You are motivated to seek out experiences that provide a strong feeling of %s",a));break;case 3:s=y(t("Your choices are driven by a desire for %s",a))}return s=format(s,o).concat("."),i.push(s),i}function p(e,a){return[c(e.children[0],a),d(e.children[0],a),l(e.children[1],a),h(e.children[2],a)]}function f(e,a){return p(e.tree,a).map(function(e){return e.join(" ")}).join("\n")}var g={},m=i18n.getDictionary(e),y=i18n.translatorFactory.createTranslator(m.phrases);return g.circumplexData=m.traits,g.facetsData=m.facets,g.valuesData=m.values,g.needsData=m.needs,g.assembleTraits=c,g.assembleFacets=d,g.assembleNeeds=l,g.assembleValues=h,g.assemble=p,g.getSummary=f,g};