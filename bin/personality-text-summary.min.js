"use strict";var format=require("./format"),i18n=require("./i18n");module.exports=function(e){function a(e,a){var r=0;return Math.abs(.5-e.percentage)>Math.abs(.5-a.percentage)&&(r=-1),Math.abs(.5-e.percentage)<Math.abs(.5-a.percentage)&&(r=1),r}function r(e,a){var r=0;return Math.abs(e.percentage)>Math.abs(a.percentage)&&(r=-1),Math.abs(e.percentage)<Math.abs(a.percentage)&&(r=1),r}function t(e){var a,r={male:{"You are %s":"He is %s","You are %s and %s":"He is %s and %s","You are %s, %s and %s":"He is %s, %s and %s","And you are %s":"And he is %s","You are relatively unconcerned with both %s and %s":"He is relatively unconcerned with both %s and %s","You don't find %s to be particularly motivating for you":"He doesn't find %s to be particularly motivating for him","You value %s a bit more":"He values %s a bit more","You consider %s to guide a large part of what you do":"He considers %s to guide a large part of what he does","Experiences that make you feel high %s are generally unappealing to you":"Experiences that make him feel high %s are generally unappealing to him","Experiences that give a sense of %s hold some appeal to you":"Experiences that give a sense of %s hold some appeal to him","You are motivated to seek out experiences that provide a strong feeling of %s":"He is motivated to seek out experiences that provide a strong feeling of %s","Your choices are driven by a desire for %s":"His choices are driven by a desire for %s"},female:{"You are %s":"She is %s","You are %s and %s":"She is %s and %s","You are %s, %s and %s":"She is %s, %s and %s","And you are %s":"And she is %s","You are relatively unconcerned with both %s and %s":"She is relatively unconcerned with both %s and %s","You don't find %s to be particularly motivating for you":"She doesn't find %s to be particularly motivating for her","You value %s a bit more":"She values %s a bit more","You consider %s to guide a large part of what you do":"She considers %s to guide a large part of what she does","Experiences that make you feel high %s are generally unappealing to you":"Experiences that make her feel high %s are generally unappealing to her","Experiences that give a sense of %s hold some appeal to you":"Experiences that give a sense of %s hold some appeal to her","You are motivated to seek out experiences that provide a strong feeling of %s":"She is motivated to seek out experiences that provide a strong feeling of %s","Your choices are driven by a desire for %s":"Her choices are driven by a desire for %s"},"default":{"You are %s":"You are %s","You are %s and %s":"You are %s and %s","You are %s, %s and %s":"You are %s, %s and %s","And you are %s":"And you are %s","You are relatively unconcerned with both %s and %s":"You are relatively unconcerned with both %s and %s","You don't find %s to be particularly motivating for you":"You don't find %s to be particularly motivating for you","You value %s a bit more":"You value %s a bit more","You consider %s to guide a large part of what you do":"You consider %s to guide a large part of what you do","Experiences that make you feel high %s are generally unappealing to you":"Experiences that make you feel high %s are generally unappealing to you","Experiences that give a sense of %s hold some appeal to you":"Experiences that give a sense of %s hold some appeal to you","You are motivated to seek out experiences that provide a strong feeling of %s":"You are motivated to seek out experiences that provide a strong feeling of %s","Your choices are driven by a desire for %s":"Your choices are driven by a desire for %s"},they:{"You are %s":"They are %s","You are %s and %s":"They are %s and %s","You are %s, %s and %s":"They are %s, %s and %s","And you are %s":"And they are %s","You are relatively unconcerned with both %s and %s":"They are relatively unconcerned with both %s and %s","You don't find %s to be particularly motivating for you":"They don't find %s to be particularly motivating for them","You value %s a bit more":"They value %s a bit more","You consider %s to guide a large part of what you do":"They consider %s to guide a large part of what they do","Experiences that make you feel high %s are generally unappealing to you":"Experiences that make them feel high %s are generally unappealing to them","Experiences that give a sense of %s hold some appeal to you":"Experiences that give a sense of %s hold some appeal to them","You are motivated to seek out experiences that provide a strong feeling of %s":"They are motivated to seek out experiences that provide a strong feeling of %s","Your choices are driven by a desire for %s":"Their choices are driven by a desire for %s"}};return a=m.subject&&r[m.subject]||r["default"],a[e]||e}function o(e,a,r){var t=[e,a].sort(function(e,a){var r="EANOC".indexOf(e.id.charAt(0)),t="EANOC".indexOf(a.id.charAt(0));return t>r?-1:1}),o=t[0].id.concat(t[0].percentage>.5?"_plus_":"_minus_").concat(t[1].id).concat(t[1].percentage>.5?"_plus":"_minus"),s=m.circumplexData[o][0],n="%s";if(s.perceived_negatively)switch(r){case 0:n=v("a bit %s");break;case 1:n=v("somewhat %s");break;case 2:n=v("can be perceived as %s")}return format(n,s.word)}function s(e){var a,r,t=m.facetsData[e.id.replace("_","-").replace(" ","-")];return e.percentage>.5?(a=t.HighTerm.toLowerCase(),r=t.HighDescription.toLowerCase()):(a=t.LowTerm.toLowerCase(),r=t.LowDescription.toLowerCase()),{name:e.id,term:a,description:r}}function n(e){return Math.min(Math.floor(4*e),3)}function i(e){var a=m.valuesData[e.id.replace(/[_ ]/g,"-")][0],r=e.percentage>.5?a.HighDescription:a.LowDescription;return{name:e.id,term:a.Term.toLowerCase(),description:r}}function u(e){var a=m.needsData[e.id];return a}function c(e){var r,s,n,i,u,c=[],d=[];switch(e.children[0].children.forEach(function(e){d.push({id:e.id,percentage:e.percentage})}),d.sort(a),r=d.filter(function(e){return Math.abs(.5-e.percentage)>.18}),r.length<2&&(r=[d[0],d[1]]),r.length){case 2:s=o(r[0],r[1],0),c.push(format(v(t("You are %s")),s)+".");break;case 3:n=o(r[0],r[1],0),i=o(r[1],r[2],1),c.push(format(v(t("You are %s and %s")),n,i)+".");break;case 4:case 5:n=o(r[0],r[1],0),i=o(r[1],r[2],1),u=o(r[2],r[3],2),c.push(format(v(t("You are %s, %s and %s")),n,i,u)+".")}return c}function d(e){var r,o,n=[],i=[];if(e.children[0].children.forEach(function(e){e.children.forEach(function(a){i.push({id:a.id,percentage:a.percentage,parent:e})})}),i.sort(a),r=s(i[0]),n.push(format(v(t("You are %s")),r.term)+": "+r.description+"."),r=s(i[1]),n.push(format(v(t("You are %s")),r.term)+": "+r.description+"."),o=2,i[0].parent===i[1].parent)for(;i[0].parent===i[o].parent;)o+=1;return r=s(i[o]),n.push(format(v(t("And you are %s")),r.term)+": "+r.description+"."),n}function h(e){var r,o,s,u,c,d,h,l,p=[],f=[];if(e.children[0].children.forEach(function(e){f.push({id:e.id,percentage:e.percentage})}),f.sort(a),r=n(f[0].percentage)===n(f[1].percentage),o=i(f[0]),s=i(f[1]),r){switch(h=o.term,l=s.term,n(f[0].percentage)){case 0:u=format(v(t("You are relatively unconcerned with both %s and %s")),h,l)+".";break;case 1:u=format(v(t("You don't find either %s or %s to be particularly motivating for you")),h,l)+".";break;case 2:u=format(v(t("You value both %s and %s a bit")),h,l)+".";break;case 3:u=format(v(t("You consider both %s and %s to guide a large part of what you do")),h,l)+"."}p.push(u),p.push(o.description+"."),p.push(format(v("And %s"),s.description.toLowerCase())+".")}else for(c=[o,s],d=0;d<c.length;d+=1){switch(n(f[d].percentage)){case 0:u=format(v(t("You are relatively unconcerned with %s")),c[d].term);break;case 1:u=format(v(t("You don't find %s to be particularly motivating for you")),c[d].term);break;case 2:u=format(v(t("You value %s a bit more")),c[d].term);break;case 3:u=format(v(t("You consider %s to guide a large part of what you do")),c[d].term)}u=u.concat(": ").concat(c[d].description.toLowerCase()).concat("."),p.push(u)}return p}function l(e){var a,o,s=[],i=[];switch(e.children[0].children.forEach(function(e){i.push({id:e.id,percentage:e.percentage})}),i.sort(r),a=u(i[0])[0],n(i[0].percentage)){case 0:o=v(t("Experiences that make you feel high %s are generally unappealing to you"));break;case 1:o=v(t("Experiences that give a sense of %s hold some appeal to you"));break;case 2:o=v(t("You are motivated to seek out experiences that provide a strong feeling of %s"));break;case 3:o=v(t("Your choices are driven by a desire for %s"))}return o=format(o,a).concat("."),s.push(o),s}function p(e){return[c(e.children[0]),d(e.children[0]),l(e.children[1]),h(e.children[2])]}function f(e){return p(e.tree).map(function(e){return e.join(" ")}).join("\n")}function g(e){switch(e){case"male":case"female":case"they":m.subject=e;break;default:m.subject="you"}return m.subject}var m={},y=i18n.getDictionary(e),v=i18n.translatorFactory.createTranslator(y.phrases);return m.circumplexData=y.traits,m.facetsData=y.facets,m.valuesData=y.values,m.needsData=y.needs,m.subject="you",m.assembleTraits=c,m.assembleFacets=d,m.assembleNeeds=l,m.assembleValues=h,m.assemble=p,m.getSummary=f,m.setSubject=g,m};